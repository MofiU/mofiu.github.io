{"meta":{"title":null,"subtitle":"帅是一种生活态度~","description":null,"author":"Zeng Bo","url":"https://mofiu.github.io"},"pages":[{"title":"About","date":"2017-10-25T06:58:11.340Z","updated":"2017-10-25T06:58:11.340Z","comments":true,"path":"about/index.html","permalink":"https://mofiu.github.io/about/index.html","excerpt":"","text":"帅是一种生活态度~"},{"title":"Categories","date":"2017-10-25T06:57:04.441Z","updated":"2017-10-25T06:57:04.441Z","comments":true,"path":"categories/index.html","permalink":"https://mofiu.github.io/categories/index.html","excerpt":"","text":""},{"title":"Tags","date":"2017-10-25T06:49:53.160Z","updated":"2017-10-25T06:49:53.160Z","comments":true,"path":"tags/index.html","permalink":"https://mofiu.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"gitment in hexo","slug":"gitment-in-hexo","date":"2017-10-25T02:23:56.000Z","updated":"2017-10-26T09:25:54.032Z","comments":true,"path":"2017/10/25/gitment-in-hexo/","link":"","permalink":"https://mofiu.github.io/2017/10/25/gitment-in-hexo/","excerpt":"在yilia中加入gitment评论功能","text":"在yilia中加入gitment评论功能 注册一个应用https://github.com/settings/applications/new Application name: BlogHomepage URL: https://mofiu.github.ioApplication description: 随意Authorization callback URL: https://mofiu.github.io 获取client id 和client serect 填写gitment配置 12345gitment_owner: MofiU #你的 GitHub Namegitment_repo: 'mofiu.github.io' #存储评论的 repogitment_oauth: client_id: xxxxxxxx #client ID client_secret: xxxxxxx #client secret hexo generate; hexo deploy","categories":[{"name":"hexo","slug":"hexo","permalink":"https://mofiu.github.io/categories/hexo/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://mofiu.github.io/tags/hexo/"},{"name":"git","slug":"git","permalink":"https://mofiu.github.io/tags/git/"}]},{"title":"rails active_jobsidekiq","slug":"rails-active-jobsidekiq","date":"2017-10-24T06:50:23.000Z","updated":"2017-10-26T09:25:46.654Z","comments":true,"path":"2017/10/24/rails-active-jobsidekiq/","link":"","permalink":"https://mofiu.github.io/2017/10/24/rails-active-jobsidekiq/","excerpt":"Sidekiq Simple, efficient background processing for Ruby.Sidekiq uses threads to handle many jobs at the same time in the same process. It does not require Rails but will integrate tightly with Rails to make background processing dead simple.","text":"Sidekiq Simple, efficient background processing for Ruby.Sidekiq uses threads to handle many jobs at the same time in the same process. It does not require Rails but will integrate tightly with Rails to make background processing dead simple. Sidekiq is compatible with Resque. It uses the exact same message format as Resque so it can integrate into an existing Resque processing farm. You can have Sidekiq and Resque run side-by-side at the same time and use the Resque client to enqueue jobs in Redis to be processed by Sidekiq. Notice:所有操作必须在OS已安装redis服务器和客户端的前提下进行 1.加入必需的gem 1234gem &apos;redis&apos; # redisgem &apos;redis-namespace&apos; #如果使用了redis的namespace则必须加入这个gemgem &apos;sidekiq&apos; # https://github.com/mperham/sidekiqgem &apos;sinatra&apos;, require: nil # sidekiq自带的监控页面 配置sidekiq 在initializers下新建sidekiq.rb文件，用来初始化Redis和Sidekiq config。 initializers/sidekiq.rb ： 12345678910111213redis_server = &apos;127.0.0.1&apos; # redis服务器redis_port = 6379 # redis端口redis_db_num = 0 # redis 数据库序号redis_namespace = &apos;highlander22_sidekiq&apos; #命名空间，自定义的Sidekiq.configure_server do |config| p redis_server # 这个可以去掉 config.redis = &#123; url: &quot;redis://#&#123;redis_server&#125;:#&#123;redis_port&#125;/#&#123;redis_db_num&#125;&quot;, namespace: redis_namespace &#125;endSidekiq.configure_client do |config| config.redis = &#123; url: &quot;redis://#&#123;redis_server&#125;:#&#123;redis_port&#125;/#&#123;redis_db_num&#125;&quot;, namespace: redis_namespace &#125;end sidekiq 启动配置文件 config/sidekiq.yml: 12345678910111213:concurrency: 5 # 并发数:pidfile: tmp/pids/sidekiq.pid:logfile: ./log/sidekiq.log # 输出的日志地址:queues: - default # 写在队列参数中的, 表示让 sidekiq 处理这个 queue - [myqueue, 2] # 使用数组的形式写, 第一个参数为打开的 queue 的名称, 第二个为优先级development: :concurrency: 5staging: :concurrency: 10production: :concurrency: 20 3.rails和OS相关配置 预设的ActiveJob Adapter是:inline，也就是沒有非同步。我們必编辑config/environments/production.rb切换成改用sidekiq如下: 1config.eager_load_paths += %W( #&#123;config.root&#125;/app/jobs ) 修改路由配置，如果使用自带的监控页面 12require &apos;sidekiq/web&apos;mount Sidekiq::Web =&gt; &apos;/sidekiq&apos; 启动redis redis start 启动sidekiq bundle exec sidekiq 或者 sidekiq 建立Worker 执行rails g job hard_worker产生app/jobs/hard_worker_job.rb文件 12345678# app/jobs/hard_worker_job.rbclass HardWorkerJob &lt; ActiveJob::Base queue_as :default def perform(*args) # Do something later endend 绘制UI example 12345678910111213141516171819202122232425&lt;%= form_for :sidekiq_job, url: home_sidekiq_job_path, html: &#123;remote: true, class: &apos;form-horizontal&apos;, style: &apos;margin-top: 100px;&apos;&#125; do |f| %&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;%= f.label :count, &apos;任务条数&apos;, class: &apos;col-sm-2 control-label&apos; %&gt; &lt;div class=&quot;col-md-2&quot;&gt; &lt;%= f.text_field :count, class: &apos;form-control&apos; %&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;%= f.label :delay, &apos;延迟执行(Sec)&apos;, class: &apos;col-sm-2 control-label&apos; %&gt; &lt;div class=&quot;col-md-2&quot;&gt; &lt;%= f.text_field :delay, class: &apos;form-control&apos; %&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;div class=&quot;col-md-2 col-md-offset-2&quot;&gt; &lt;%= f.submit &apos;开始执行&apos;, class: &apos;btn btn-primary&apos; %&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;div class=&quot;col-md-2 col-md-offset-2&quot;&gt; &lt;%= link_to &apos;sidekiq后台监控页面&apos;, sidekiq_web_path, class: &apos;btn btn-primary&apos;, target: &apos;_blank&apos; %&gt; &lt;/div&gt; &lt;/div&gt;&lt;% end %&gt; 6.controller example 12345678class HomeController &lt; ApplicationController def sidekiq_job count = params[:sidekiq_job][:count].present? ? params[:sidekiq_job][:count] : 1 count.to_i.times do HardWorkerJob.set(wait: params[:sidekiq_job][:delay].present? ? params[:sidekiq_job][:delay].to_i.seconds : 0.seconds).perform_later(&#123;name: &apos;bobo&apos;&#125;) end end end 7.sidekiq任务后台 123456789101112131415161718192016-10-11T08:51:31.312Z 1566 TID-icqgs HardWorkerJob JID-422af1de0943c9e42f78d935 INFO: start2016-10-11T08:51:31.313Z 1566 TID-icq6s HardWorkerJob JID-bbbf1661d67720af7ca93bfe INFO: done: 0.01 sec2016-10-11T08:51:31.314Z 1566 TID-tb8ts HardWorkerJob JID-4965925fa4718f899684d673 INFO: done: 0.025 sec2016-10-11T08:51:31.318Z 1566 TID-icpxw HardWorkerJob JID-c0c08f88dbd27f787b5d7541 INFO: done: 0.01 sec2016-10-11T08:51:31.320Z 1566 TID-icq6s HardWorkerJob JID-9aaf9bb533cd16ad450252d0 INFO: start2016-10-11T08:51:31.321Z 1566 TID-icqgs HardWorkerJob JID-422af1de0943c9e42f78d935 INFO: done: 0.008 sec2016-10-11T08:51:31.324Z 1566 TID-icpxw HardWorkerJob JID-39f9c2c7cc4658e8df6781d3 INFO: start2016-10-11T08:51:31.324Z 1566 TID-tb8ts HardWorkerJob JID-bfa8c5d163330738fec2ab1c INFO: start2016-10-11T08:51:31.325Z 1566 TID-icqgs HardWorkerJob JID-ec8412afdc039b15a6ed8261 INFO: start2016-10-11T08:51:31.326Z 1566 TID-icq6s HardWorkerJob JID-9aaf9bb533cd16ad450252d0 INFO: done: 0.006 sec2016-10-11T08:51:31.331Z 1566 TID-icq6s HardWorkerJob JID-82e342c48725baafe330295c INFO: start2016-10-11T08:51:31.333Z 1566 TID-icq6s HardWorkerJob JID-82e342c48725baafe330295c INFO: done: 0.002 sec2016-10-11T08:51:31.334Z 1566 TID-icq6s HardWorkerJob JID-679af91cc3d9c7466c1235a6 INFO: start2016-10-11T08:51:31.336Z 1566 TID-icqgs HardWorkerJob JID-ec8412afdc039b15a6ed8261 INFO: done: 0.01 sec2016-10-11T08:51:31.337Z 1566 TID-icqgs HardWorkerJob JID-4e9bfb4cb5de73981bf3241d INFO: start2016-10-11T08:51:31.338Z 1566 TID-tb8ts HardWorkerJob JID-bfa8c5d163330738fec2ab1c INFO: done: 0.014 sec2016-10-11T08:51:31.340Z 1566 TID-tb8ts HardWorkerJob JID-f75df49e66886537a58bc23f INFO: start2016-10-11T08:51:31.342Z 1566 TID-icqgs HardWorkerJob JID-4e9bfb4cb5de73981bf3241d INFO: done: 0.005 sec2016-10-11T08:51:31.343Z 1566 TID-icqgs HardWorkerJob JID-36e7b58515c2cc72b599c1fa INFO: start","categories":[{"name":"后端","slug":"后端","permalink":"https://mofiu.github.io/categories/后端/"}],"tags":[{"name":"rails","slug":"rails","permalink":"https://mofiu.github.io/tags/rails/"}]},{"title":"rails g not work","slug":"rails-g-not-work","date":"2017-10-23T09:40:14.000Z","updated":"2017-10-26T09:25:42.314Z","comments":true,"path":"2017/10/23/rails-g-not-work/","link":"","permalink":"https://mofiu.github.io/2017/10/23/rails-g-not-work/","excerpt":"","text":"I think Spring is misbehaving, and not re-requiring gems correctly. Check spring’s status with bin/spring status. If it’s running, try stopping it with bin/spring stop. If it’s not, check to see if there are any orphan Spring processes that might be screwing things up: ps aux | grep spring. I’m not entirely sure why Spring is acting like this, but killing it off fixed the issue for me. I was unable to replicate again to investigate further.","categories":[{"name":"后端","slug":"后端","permalink":"https://mofiu.github.io/categories/后端/"}],"tags":[{"name":"rails","slug":"rails","permalink":"https://mofiu.github.io/tags/rails/"}]}]}